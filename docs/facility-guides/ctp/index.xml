<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>UQ-RCC XNAT – Clinical Trials Processor (CTP)</title><link>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/</link><description>Recent content in Clinical Trials Processor (CTP) on UQ-RCC XNAT</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: Installation</title><link>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/installation/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/installation/</guid><description>
&lt;h3 id="installing-ctp-on-windows-10">Installing CTP on Windows 10&lt;/h3>
&lt;p>CTP installation steps&lt;/p>
&lt;ol>
&lt;li>Create a new user for CTP on UQ RCC XNAT (not an AAF/OpenID user) with required project access, without admin access&lt;/li>
&lt;li>Download the following files
&lt;ul>
&lt;li>&lt;a href="https://github.com/johnperry/CTP/raw/master/products/CTP-installer.jar">CTP-installer.jar&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/Australian-Imaging-Service/configuration/raw/0c784a9bdd817ee5e0534034a5a108b4a1c6f4aa/CTP/ctp_clinical_site_to_xnat_config.xml">ctp_clinical_site_to_xnat_config.xml&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://dicom.offis.de/download/dcmtk/dcmtk366/bin/dcmtk-3.6.6-win64-dynamic.zip">dcmtk-3.6.6-win64-dynamic.zip&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://www.rubomedical.com/dicom_files/dicom_viewer_Mrbrain.zip">dicom_viewer_Mrbrain.zip&lt;/a>&lt;/li>
&lt;li>Optional if you need more DICOM samples: &lt;a href="https://download.nrg.wustl.edu/pub/data/sample1.zip">sample1.zip&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Install CTP using:
&lt;pre tabindex="0">&lt;code>cd INSTALL_FOLDER (replace with your actual folder)
java -jar CTP-installer.jar
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>Replace CTP/config.xml with ctp_clinical_site_to_xnat_config.xml&lt;/li>
&lt;li>Edit CTP/config.xml
&lt;ul>
&lt;li>Change &amp;ldquo;xxxx.xxxx&amp;rdquo; in two &amp;ldquo;url&amp;rdquo; tags to &amp;ldquo;xnat.rcc.uq.edu.au&amp;rdquo;&lt;/li>
&lt;li>Change &amp;ldquo;xxxx&amp;rdquo; username and password tags to match new user from step 1&lt;/li>
&lt;li>If CTP internet access is via a proxy server, add the proxy server element to the Server config
&lt;pre tabindex="0">&lt;code>...
&amp;lt;Server ...&amp;gt;
&amp;lt;ProxyServer
proxyIPAddress=&amp;#34;&amp;#34;
proxyPort=&amp;#34;&amp;#34;
proxyUsername=&amp;#34;&amp;#34;
proxyPassword=&amp;#34;&amp;#34;/&amp;gt;
&amp;lt;/Server&amp;gt;
...
&lt;/code>&lt;/pre>Once this element is added proxy server settings can be updated in the CTP Launcher GUI&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Add CTP the anonymiser script
&lt;ul>
&lt;li>Copy CTP/scripts/DicomServiceAnonymizer.script to CTP/scripts/dicom-anonymizer-sender.script&lt;/li>
&lt;li>Add the PROJECTID parameter to the list of parameters at the start of the file
&lt;ul>
&lt;li>&lt;code>&amp;lt;p t=&amp;quot;PROJECTID&amp;quot;&amp;gt;my xnat project id&amp;lt;/p&amp;gt;&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Change the PatientComments element 0010,4000 to set XNAT project routing info
&lt;ul>
&lt;li>&lt;code>@always()@append(){Project:@param(@PROJECTID) Subject:@contents([0010,0010]) Session:@contents([0008,0050])}&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Review/set other parameters at the start of the file
&lt;ul>
&lt;li>PROFILENAME, eg. AIS-Clinical-Site-210604&lt;/li>
&lt;li>DATEINC, eg. 0&lt;/li>
&lt;li>PROJECTNAME, SITEID, SITENAME, TRIALNAME, TRIALSPONSOR as required&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Optional: review script to check anonymisation settings are appropriate&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Start CTP GUI
&lt;pre tabindex="0">&lt;code>java -jar Launcher.jar
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>Click the CTP &amp;ldquo;Start&amp;rdquo; button&lt;/li>
&lt;li>Click the &amp;ldquo;CTP Home Page&amp;rdquo; button to open the Web UI
&lt;ul>
&lt;li>If the browser can&amp;rsquo;t connect, check CTP is not already running, or try changing the Server port&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Login
&lt;ul>
&lt;li>Top RHS banner should show &amp;ldquo;Welcome admin&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Optional: click &amp;ldquo;User Manager&amp;rdquo; to change default usernames/passwords&lt;/li>
&lt;li>Optional: click &amp;ldquo;DICOM Anonymizer&amp;rdquo; to view/edit anonymiser script&lt;/li>
&lt;li>Unzip DCMTK and MrBrain dicom sample&lt;/li>
&lt;li>Try sending an dicom to CTP using dcmtk
&lt;pre tabindex="0">&lt;code>cd dcmtk-3.6.5-win64-dynamic/bin
dcmsend localhost 25055 ../../dicom_viewer_Mrbrain/MRBRAIN.DCM
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>Login to the XNAT server with an admin account to view Prearchive
&lt;ul>
&lt;li>Use &amp;ldquo;Upload&amp;rdquo; → &amp;ldquo;Go to prearchive&amp;rdquo;&lt;/li>
&lt;li>DICOM should appear in &amp;ldquo;Receiving&amp;rdquo; status, with project id assigned from step 6
&lt;ul>
&lt;li>Optional: non-admin users need to search by subject/etc&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Use Refresh to check when &amp;ldquo;Ready&amp;rdquo; or it disappears from list (as it has been routed to the project)&lt;/li>
&lt;li>Debugging: use dcm2xml from DCMTK to check anonymised dicom file under CTP/roots/FileAfterAnonymization25055&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Logout and login with the new XNAT user from step 1&lt;/li>
&lt;li>Navigate to the project set in step 6
&lt;ul>
&lt;li>You should see the dicom listed as subject &amp;ldquo;1737775597&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Use subject &amp;ldquo;1737775597&amp;rdquo; → &amp;ldquo;MR Session&amp;rdquo; → &amp;ldquo;View Images&amp;rdquo; to view the uploaded image&lt;/li>
&lt;li>Try a dicom send from the scanner using PC address and port 25055 (check windows firewall settings?)&lt;/li>
&lt;li>Enable CTP as a Windows Service. Instructions &lt;a href="https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/windows-service">here&lt;/a>&lt;/li>
&lt;/ol>
&lt;h3 id="further-information">Further information&lt;/h3>
&lt;p>If you need a different commit of CTP-installer&lt;/p>
&lt;pre tabindex="0">&lt;code>git clone https://github.com/johnperry/CTP
cd CTP/products
git checkout &amp;lt;commit&amp;gt; CTP-Installer.jar
&lt;/code>&lt;/pre>&lt;p>If you need other AIS CTP config files&lt;/p>
&lt;pre tabindex="0">&lt;code>git clone https://github.com/Australian-Imaging-Service/configuration.git
cd configuration/CTP
&lt;/code>&lt;/pre>&lt;p>CTP documentation links:&lt;/p>
&lt;p>&lt;a href="http://mircwiki.rsna.org/index.php?title=MIRC_CTP">MIRC CTP Wiki&lt;/a>&lt;/p>
&lt;p>&lt;a href="http://mircwiki.rsna.org/index.php?title=The_CTP_DICOM_Anonymizer">CTP DICOM Anonymizer&lt;/a>&lt;/p></description></item><item><title>Docs: Proxy Server Settings</title><link>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/proxy-server/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/proxy-server/</guid><description>
&lt;p>If CTP uses a proxy server for internet access, you can update the CTP proxy server settings on Windows as follows&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Stop the CTP Windows service&lt;/p>
&lt;ul>
&lt;li>If you already have a Services short-cut on the Windows desktop, double-click the short-cut to start Windows Services&lt;/li>
&lt;li>If not, click the Windows start button, start typing &amp;ldquo;services&amp;rdquo; and the Services App icon should appear
&lt;ul>
&lt;li>Click the Services App icon to start Windows Services&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Locate the CTP service in the list of services, right-click and select &lt;strong>Stop&lt;/strong> from the context menu&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Start the CTP Launcher&lt;/p>
&lt;ul>
&lt;li>If you already have a CTP Launcher short-cut on the Windows desktop, double-click the short-cut to start the CTP Launcher&lt;/li>
&lt;li>If not, locate the CTP service in the list of services again, right-click and select &lt;strong>Properties&lt;/strong> from the context menu
&lt;ol>
&lt;li>Use the &lt;strong>Path to executable&lt;/strong> entry to find the installation folder for CTP. It will be in the form &lt;code>&amp;lt;install folder&amp;gt;\windows\CTP.exe&lt;/code>&lt;/li>
&lt;li>Open a Windows Command prompt window
&lt;ol>
&lt;li>Click the Windows Start button, start typing &amp;ldquo;cmd&amp;rdquo; and the Command Prompt App icon should appear&lt;/li>
&lt;li>Click the Command Prompt App icon to start the Command Prompt&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>In the Command Prompt window, enter the following commands&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code>cd &amp;lt;install folder&amp;gt;
java -jar Launcher.jar
&lt;/code>&lt;/pre>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Navigate to the CTP Launcher Configuration tab&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Use the navigation panel on the left to select &lt;strong>Configuration&lt;/strong> -&amp;gt; &lt;strong>Server&lt;/strong> -&amp;gt; &lt;strong>ProxyServer&lt;/strong>
&lt;img src="https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/proxy-config.png" alt="text">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Update the proxy server settings in the right panel as required. You can set an IP address or host name in the proxyIPAddress field&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Select &lt;strong>File&lt;/strong> -&amp;gt; &lt;strong>Save&lt;/strong> from the main menu bar to save your changes&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Close the CTP Launcher using the Window close button at the top right
&lt;div class="alert alert-warning" role="alert">
If the following prompt appears, select &lt;strong>No&lt;/strong>.
&lt;img src="https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/close-launcher.png" alt="text">
If the CTP is stopped, restart it from the Windows services menu (See below)
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Close the Command Prompt window&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Re-Start the CTP Windows service using Windows Services&lt;/p>
&lt;p>Locate the CTP service in the list of services, right-click and select &lt;strong>Start&lt;/strong> from the context menu&lt;/p>
&lt;p>&lt;img src="https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/windows-service.png" alt="text">&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="troubleshooting">Troubleshooting&lt;/h4>
&lt;ul>
&lt;li>If the CTP Windows service Stop is disabled, try restarting Windows Services as administrator by right-clicking the icon and selecting &lt;strong>Run as administrator&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h4 id="further-information">Further information&lt;/h4>
&lt;ul>
&lt;li>&lt;a href="https://mircwiki.rsna.org/index.php?title=MIRC_CTP#Server">CTP Server Settings&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Docs: Windows Service</title><link>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/windows-service/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/windows-service/</guid><description>
&lt;p>The CTP install.bat script uses Apache procrun. Use the following steps to enable CTP as a Windows service, including an update to use a JRE other than system default (leave out step 2 if using the system default JRE)&lt;/p>
&lt;ol>
&lt;li>Install CTP
&lt;pre tabindex="0">&lt;code>java -jar CTP-installer.jar
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>To use JRE other than system default, edit &lt;code>&amp;lt;ctp-home&amp;gt;/windows/install.bat&lt;/code>. Find the &amp;ndash;Jvm=auto, add &amp;ndash;JavaHome entry and set both as follows
&lt;pre tabindex="0">&lt;code>--JavaHome=&amp;#34;&amp;lt;jre home&amp;gt; &amp;#34; ^
--Jvm=&amp;#34;&amp;lt;jre-home&amp;gt;\bin\server\jvm.dll&amp;#34; ^
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>^ is needed to wrap/continue command line in batch file&lt;/li>
&lt;li>The jvm.dll location under &lt;jre-home> is the same for JRE 1.7 and 1.8 installs. Confirm this is the case for other JREs/JDKs&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Run install.bat as Administrator to create the CTP windows service
&lt;pre tabindex="0">&lt;code>cd &amp;lt;ctp-home&amp;gt;/windows
install
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>Open Windows Services as Administrator and start the CTP service&lt;/li>
&lt;li>Open CTP administration page in Web browser&lt;/li>
&lt;li>Confirm the correct JRE is reported in Admin → System Properties and/or Admin → Log Viewer → ctp.log&lt;/li>
&lt;/ol>
&lt;h4 id="troubleshooting">Troubleshooting&lt;/h4>
&lt;ul>
&lt;li>Installation paths are set in install.bat during CTP install so it won&amp;rsquo;t work if you move the CTP folder somewhere else after install&lt;/li>
&lt;li>If removing the service (with uninstall.bat) leaves the service stuck in delete pending state, reboot the system to complete&lt;/li>
&lt;/ul>
&lt;h4 id="further-information">Further information&lt;/h4>
&lt;ul>
&lt;li>&lt;a href="https://mircwiki.rsna.org/index.php?title=Running_CTP_as_a_Windows_Service">Running CTP as a Windows service&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://commons.apache.org/proper/commons-daemon/procrun.html">Apache procrun&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Docs: Linux Service</title><link>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/linux-service/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.xnat.rcc.uq.edu.au/docs/facility-guides/ctp/linux-service/</guid><description>
&lt;h2 id="ubuntu">Ubuntu&lt;/h2>
&lt;p>Open &lt;code>./linux/ctpService-ubuntu.sh&lt;/code>. Update the following parameters:&lt;/p>
&lt;pre tabindex="0">&lt;code>USER=ubuntu
CTP_HOME=/opt/ctp/CTP
JAVA_BIN=/usr/lib/jvm/java-17-openjdk-amd64/bin
JAVA=$JAVA_BIN/java
CTP_PID=$CTP_HOME/ctp.pid
&lt;/code>&lt;/pre>&lt;p>Run the following to install the ctpService into init.d&lt;/p>
&lt;pre tabindex="0">&lt;code>sudo ln -s ./linux/ctpService-ubuntu.sh /etc/init.d/ctpService
sudo update-rc.d ctpService defaults 98 02
&lt;/code>&lt;/pre>&lt;p>Start and stop CTP using the following commands&lt;/p>
&lt;pre tabindex="0">&lt;code>sudo service ctpService start
sudo service ctpService stop
&lt;/code>&lt;/pre></description></item></channel></rss>